
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Huray | Himom Back-office</title>

    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,400i,700&display=fallback">
    <link rel="stylesheet" href="/css/fontawesome-free/all.min.css">
    <link rel="stylesheet" href="/css/adminlte.css">
    <link rel="stylesheet" href="/css/overlayScrollbars/OverlayScrollbars.min.css">
    <!-- jsGrid -->
    <link rel="stylesheet" href="/css/jsgrid/jsgrid.min.css">
    <link rel="stylesheet" href="/css/jsgrid/jsgrid-theme.min.css">
    <!-- datepicker -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
    <link rel="stylesheet" href="/css/jquery-ui/jquery-ui.min.css">
    <!-- select box-->
    <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>
    <!-- common css-->
    <link rel="stylesheet" href="/css/common.css">

    <script src="/js/jquery/jquery.min.js"></script>
    <script src="/js/jquery-ui/jquery-ui.min.js"></script>
    <script src="/js/bootstrap/bootstrap.bundle.min.js"></script>
    <script src="/js/adminlte.js"></script>
    <script src="/js/common.js"></script>

    <!-- chart -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.12.1/css/jquery.dataTables.min.css">
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.12.1/js/jquery.dataTables.min.js"></script>
    <!--alert-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-confirm/3.3.2/jquery-confirm.min.js"></script>

    <style>
        .field-error {
            border-color: #dc3545;
            color: #dc3545;
        }
    </style>

    <!-- select box-->
    <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
</head>

<body class="hold-transition sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">
    <nav class="main-header navbar navbar-expand navbar-white navbar-light">
        <!-- Left navbar links -->
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <!--            <a th:href="@{/}" class="nav-link" data-widget="iframe-close" data-type="all">Home</a>-->
                <a href="/users" class="nav-link">Home</a>
            </li>
            <li class="nav-item d-none d-sm-inline-block">
                <a href="https://www.huray.net/" class="nav-link">Contact</a>
            </li>
        </ul>
    </nav>

    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <!-- Brand Logo -->
        <a href="/users" class="brand-link">
            <img src="/images/HM-symbol.png" alt="Huray Logo" class="brand-image img-circle elevation-4" style="opacity: .9">
            <span class="brand-text">
            <small class="font-weight-light" id="nav-site-name"></small>
        </span>

        </a>

        <!-- Sidebar -->
        <div class="sidebar text-sm">
            <!-- Sidebar user panel (optional) -->
            <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                <div class="image">
                    <img src="/images/user.png" class="img-circle elevation-2" alt="User Image">
                </div>
                <div class="info" style="z-index: 999999;">
                    <span id="nav-admin-full">Guest()</span>
                    <!--<span id="nav-admin-name">
                        Guest
                    </span>
                    ( <span id="nav-admin-loginid"></span> )-->
                    <a href="#" class="d-block dropdown-toggle" id="nav-admin-authentication" data-toggle="dropdown">Guest</a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" onclick="getAdminId();">비밀번호 변경</a></li>
                        <li><a class="dropdown-item" href="/logout">Logout</a></li>
                    </ul>
                </div>
            </div>

            <!-- Sidebar Menu -->
            <nav class="mt-2">
                <ul class="nav nav-pills nav-sidebar flex-column nav-child-indent" data-widget="treeview" role="menu" data-accordion="false">
                    <li class="nav-item">
                        <a href="/users" class="nav-link">
                            <i class="nav-icon fas fa-user"></i>
                            <p>
                                회원 관리
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/interventions" class="nav-link">
                            <i class="nav-icon fas fa-user"></i>
                            <p>
                                중재 관리
                            </p>
                        </a>
                    </li>
                    <li class="nav-item menu-open">
                        <a href="#" class="nav-link">
                            <i class="nav-icon fas fa-folder-open"></i>
                            <p>
                                종합 관리
                                <i class="fas fa-angle-left right"></i>
                            </p>
                        </a>
                        <ul class="nav nav-treeview">
                            <li class="nav-item">
                                <a href="/period_surveys" class="nav-link">
                                    <i class="far fa-calendar nav-icon"></i>
                                    <p>설문시기별 설문기록</p>
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="/mother-surveys" class="nav-link">
                                    <i class="far fa-calendar nav-icon"></i>
                                    <p>산모별 설문기록</p>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a href="/notifications" class="nav-link">
                            <i class="nav-icon fas fa-bell"></i>
                            <p>
                                알림 관리
                            </p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="/sites" class="nav-link">
                            <i class="nav-icon fas fa-hospital"></i>
                            <p>
                                병원 관리
                            </p>
                        </a>
                    </li>

                    <li class="nav-item">
                        <a href="/candidates" class="nav-link">
                            <i class="nav-icon fas fa-id-card"></i>
                            <p>
                                사전가입자 관리
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/admins" class="nav-link">
                            <i class="nav-icon fas fa-users-cog"></i>
                            <p>
                                운영자 관리
                            </p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="/voc" class="nav-link">
                            <i class="nav-icon fas fa-users-cog"></i>
                            <p>
                                문의 관리
                            </p>
                        </a>
                    </li>
                </ul>
            </nav>
            <!-- /.sidebar-menu -->

        </div>
        <!-- /.sidebar -->
    </aside>

    <!-- Content Wrapper. Contains page content -->
    <!--<div class="content-wrapper">

        &lt;!&ndash; Content Header (Page header) &ndash;&gt;
        <div th:replace="fragments/header :: content-header"></div>

        &lt;!&ndash; Main content &ndash;&gt;
        <div layout:fragment="content"></div>
    </div>-->
    <!-- /.content-wrapper -->
    <div class="text-sm">
        <div class="content-wrapper">
            <section class="content">
                <input type="hidden" name="userId" id="userId" value="1003">
                <div class="container-fluid">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card card-primary">
                                <div class="card-body box-profile">
                                    <table class="table table-bordered">
                                        <tbody>
                                        <tr><td><p class="text-muted text-center" )>출산,아기,기록(null)</p></td></tr>
                                        <tr>
                                            <td>
                                                <p class="text-center">
                                                    <img class="profile-user-img img-fluid img-circle" src="/images/user.png" alt="User profile picture">
                                                </p>
                                                <p class="text-center">여,
                                                    32세</p>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>
                                        <span>
                                            <a href="/notifications/send-view?userIds=1003&amp;&amp;messageType=PUSH&amp;&amp;redirectUrl=/users/1003"  class="btn btn-success btn-block">
                                                <b>푸시메시지</b>
                                            </a>
                                            <a href="/notifications/send-view?userIds=1003&amp;&amp;messageType=SMS&amp;&amp;redirectUrl=/users/1003"  class="btn btn-success btn-block">
                                                <b>문자메시지</b>
                                            </a>
                                        </span>
                                            </td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-body box-profile">
                                    <table class="table table-bordered">
                                        <tbody>
                                        <tr>
                                            <td>병원</td>
                                            <td>name</td>
                                        </tr>
                                        <tr>
                                            <td>전화번호</td>
                                            <td>01026933821</td>
                                        </tr>
                                        <tr>
                                            <td>서비스 가입일</td>
                                            <td>2022-09-30</td>
                                        </tr>
                                        <tr>
                                            <td>키</td>
                                            <td>165.0</td>
                                        </tr>
                                        <tr>
                                            <td>몸무게</td>
                                            <td>52.0</td>
                                        </tr>
                                        <tr>
                                            <td>BMI</td>
                                            <td>19.1</td>
                                        </tr>
                                        <tr>
                                            <td>혈액형</td>
                                            <td>A</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-body box-profile">
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>기기정보</tr>
                                        <tr></tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>최종 app 접속일시</td>
                                            <td></td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="card-body box-profile">
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>관리정보</tr>
                                        <tr></tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td>출산예정일</td>
                                            <td>2023-06-10</td>
                                        </tr>
                                        <tr>
                                            <td>임신주차</td>
                                            <td>33주차</td>
                                        </tr>
                                        <tr>
                                            <td>대표 질환</td>
                                            <td>고혈압</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    </br>
                                    <!--고혈압인 경우 표기할 상세 정보-->
                                    <table class="table table-bordered">
                                        <tbody>
                                        <tr>
                                            <td>최근측정일시</td>
                                            <td></td>
                                        </tr>
                                        <tr>
                                            <td>수축기</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>이관기</td>
                                            <td>0</td>
                                        </tr>
                                        <tr>
                                            <td>맥박</td>
                                            <td>0</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                    <!-- 당뇨인 경우 표기할 상세 정보-->

                                    <!-- 우울증인 경우 표기할 상세 정보-->

                                </div>
                                <div class="card-body box-profile">
                                    <table class="table table-bordered">
                                        <thead>
                                        <tr>전담자</tr>
                                        </thead>
                                        <tbody>
                                        <tr>
                                            <td )>-</td>
                                        </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-9">
                            <div class="card">
                                <div class="card-header p-2">
                                    <ul class="nav nav-pills">
                                        <li class="nav-item"><a class="nav-link nav-link-default" href="#recordManagement" data-toggle="tab">기록관리</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#surveyRecords" data-toggle="tab">설문기록</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#diary" data-toggle="tab">다이어리</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#hospitalVisitRecords" data-toggle="tab">병원방문기록</a></li>
                                        <li class="nav-item"><a class="nav-link" href="#babyRecords" data-toggle="tab">신생아 정보</a></li>
                                    </ul>
                                </div>
                                <div class="card-body">
                                    <div class="tab-content">
                                        <div class="tab-pane active" id="recordManagement"><div>
                                            <div class="card card-outline">
                                                <div class="card-body">
                                                    <form>
                                                        <div class="form-group row">
                                                            <select class="form-control col-sm-2" onchange="changeSearchOption(this.value)">
                                                                <option value="ALL">전체</option>
                                                                <option value="7DAYS">7일</option>
                                                                <option value="14DAYS">14일</option>
                                                                <option value="1MONTH">1개월</option>
                                                                <option value="2MONTHS">2개월</option>
                                                                <option value="3MONTHS">3개월</option>
                                                                <option value="6MONTHS">6개월</option>
                                                            </select>
                                                            <div class="input-group date col-sm-4"  data-target-input="nearest">
                                                                <input type="text" class="form-control datetimepicker-input" id="searchStartDate">
                                                                <div class="input-group-append" data-toggle="datetimepicker">
                                                                    <div class="input-group-text "><i class="fa fa-calendar "></i></div>
                                                                </div>
                                                            </div>
                                                            ~
                                                            <div class="input-group date col-sm-4" data-target-input="nearest" >
                                                                <input type="text" class="form-control datetimepicker-input" id="searchEndDate">
                                                                <div class="input-group-append" data-toggle="datetimepicker">
                                                                    <div class="input-group-text "><i class="fa fa-calendar"></i></div>
                                                                </div>
                                                            </div>
                                                            <div class="input-group-append">
                                                                <button type="button" class="btn btn-md btn-success" onclick="searchLogs()">
                                                                    <i class="fa fa-search"></i>
                                                                </button>
                                                            </div>
                                                        </div>

                                                        <div class="form-check-inline" style="text-align: center;">
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle"  type="checkbox" id="bloodPressureChkBloodPressure" checked data-target-area="bloodPressureArea">
                                                                <label class="form-check-label" for="bloodPressureChkBloodPressure">혈압</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="bloodSugarChkBloodPressure" checked data-target-area="bloodSugarArea">
                                                                <label class="form-check-label" for="bloodSugarChkBloodPressure">혈당</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox" id="weightChkBloodPressure" checked data-target-area="weightArea">
                                                                <label class="form-check-label" for="weightChkBloodPressure">체중</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="mealChkBloodPressure" checked data-target-area="mealArea">
                                                                <label class="form-check-label" for="mealChkBloodPressure">식사</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="stepChkBloodPressure" checked data-target-area="stepArea">
                                                                <label class="form-check-label" for="stepChkBloodPressure">걸음</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="exerciseChkBloodPressure" checked data-target-area="exerciseArea">
                                                                <label class="form-check-label" for="exerciseChkBloodPressure">운동</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="medicationChkBloodPressure" checked data-target-area="medicationArea">
                                                                <label class="form-check-label" for="medicationChkBloodPressure">복약</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="smokingChkBloodPressure" checked data-target-area="smokingArea">
                                                                <label class="form-check-label" for="smokingChkBloodPressure">흡연</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="drinkingChkBloodPressure" checked data-target-area="drinkingArea">
                                                                <label class="form-check-label" for="drinkingChkBloodPressure">음주</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle area-toserviceGroupResourceIdggle" type="checkbox"  id="sleepingChkBloodPressure" checked data-target-area="sleepingArea">
                                                                <label class="form-check-label" for="sleepingChkBloodPressure">수면</label>
                                                            </div>
                                                            <div class="form-check">
                                                                <input class="form-check-input area-toggle" type="checkbox"  id="depressionChkBloodPressure" checked data-target-area="depressionArea">
                                                                <label class="form-check-label" for="depressionChkBloodPressure">우울증</label>
                                                            </div>
                                                        </div>



                                                    </form>
                                                </div>
                                            </div>
                                            <!-- 혈압환자   -->
                                            <div>

                                                <div id="bloodPressureArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">혈압</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#bloodPressureLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#bloodPressureTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="bloodPressureLine">
                                                                    <canvas id="bloodPressureLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="bloodPressureTable"></div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initBloodPressureLogData(params){
                                                        $.ajax({
                                                            url: "/blood-pressure-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (bloodPressureLogDatas) {
                                                                initBloodPressureTable(bloodPressureLogDatas);
                                                                initBloodPressureChart(bloodPressureLogDatas);
                                                            }
                                                        });
                                                    }

                                                    function initBloodPressureTable(logDatas) {
                                                        // - 저혈압(파란색): SBP 90mmHg미만 and DBP 60mmHg 미만
                                                        // - 정상(검정색): SBP 90 이상-120mmHg 미만 and DBP 60 이상- 80mmHg미만
                                                        // - 고혈압 전단계(주황색): SBP 120 이상-140 미만mmHg or DBP80 이상-90 미만mmHg
                                                        // - 고혈압 (1,2 단계)(빨간색): SBP 140mmHg  이상 or DBP 90mmHg  이상
                                                        $("#bloodPressureTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "dbp", title: "이완기", type: "text", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        if(item.sbp < 90 && item.dbp < 60) {
                                                                            return $("<div>").css("color", "blue").html(value);
                                                                        } else if((item.sbp >= 120 && item.sbp < 140) || (item.dbp >= 60 && item.dbp < 90)) {
                                                                            value.class
                                                                            return $("<div>").css("color", "orange").html(value);
                                                                        } else if(item.sbp >= 140 && item.dbp >= 90) {
                                                                            return $("<div>").css("color", "red").html(value);
                                                                        } else {
                                                                            return value;
                                                                        }
                                                                    }
                                                                },
                                                                {name: "sbp", title: "수축기", type: "body", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        if(item.sbp < 90 && item.dbp < 60) {
                                                                            return $("<div>").css("color", "blue").html(value);
                                                                        } else if((item.sbp >= 120 && item.sbp < 140) || (item.dbp >= 60 && item.dbp < 90)) {
                                                                            return $("<div>").css("color", "orange").html(value);
                                                                        } else if(item.sbp >= 140 && item.dbp >= 90) {
                                                                            return $("<div>").css("color", "red").html(value);
                                                                        } else {
                                                                            return value;
                                                                        }
                                                                    }
                                                                },
                                                                {name: "heart_rate", title: "맥박", type: "text", align: "center"},
                                                                {name: "source_name", title: "측정방법", type: "text", align: "center"},
                                                                {name: "symptom_str", title: "증상", type: "text", align: "center"},
                                                                {name: "note", title: "메모", type: "text", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let bloodPressureChart;
                                                    function initBloodPressureChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const dbpDatas = [];
                                                        const sbpDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            dbpDatas.push({x: data.log_dttm, y: data.dbp});
                                                            sbpDatas.push({x: data.log_dttm, y: data.sbp});
                                                        })
                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());
                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: dbpDatas,
                                                                label: "이완기",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            },  {
                                                                data: sbpDatas,
                                                                label: "수축기",
                                                                borderColor: "#3cba9f",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (bloodPressureChart !== undefined) {
                                                            bloodPressureChart.destroy();
                                                        }

                                                        bloodPressureChart = new Chart(
                                                            document.getElementById("bloodPressureLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>


                                                <div id="bloodSugarArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">혈당</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#bloodSugarLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#bloodSugarTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="bloodSugarLine">
                                                                    <canvas id="bloodSugarLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="bloodSugarTable">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initBloodSugarLogData(params) {
                                                        $.ajax({
                                                            url: "/blood_sugar_logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (bloodSugarLogDatas) {
                                                                initBloodSugarTable(bloodSugarLogDatas);
                                                                initBloodSugarChart(bloodSugarLogDatas);
                                                            }
                                                        });
                                                    }

                                                    function initBloodSugarTable(logDatas) {
                                                        $("#bloodSugarTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "bs", title: "측정치", type: "text", align: "center",
                                                                    itemTemplate: function(value, item) {
                                                                        // 1. 저혈당: 빨간색 - 식전/공복: 45 ~70 mg/dL && 식후: < 89 mg/dL
                                                                        // 2.정상: 검정색 - 식전/공복: 71 ~ 129 mg/dL && 식후: 90 ~ 179mg/dL
                                                                        // 3. 고혈당 위험: 주황색 - 식전/공복: 130~199mg/dL && 식후: 180~199mg/dL
                                                                        // 4. 고혈당: 빨간색 - 공복/식전/식후: >= 200mg/dL
                                                                        if(value >= 200) {
                                                                            return  $("<div>").css("color", "red").html(value);
                                                                        }
                                                                        if(value === 1 && item.bs_type ===2) { // 식전, 공복(item.bs_type ===2인 경우)
                                                                            if(value >= 45 && value <= 70) return $("<div>").css("color", "red").html(value);
                                                                            if(value >= 130 && value <= 199) return  $("<div>").css("color", "orange").html(value);
                                                                        }
                                                                        if(value === 2) { //식후
                                                                            if(value < 89) return $("<div>").css("color", "red").html(value);
                                                                            if(value >= 180 && value <= 199) return  $("<div>").css("color", "orange").html(value);
                                                                        }
                                                                        return value;
                                                                    }
                                                                },
                                                                {name: "period", title: "측정시기", type: "body", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        if(value === 1 && item.bs_type ===2) {
                                                                            return "공복"
                                                                        }
                                                                        if(value === 1 && item.bs_type !==2) {
                                                                            return "식전"
                                                                        }
                                                                        if(value === 2) {
                                                                            return "식후"
                                                                        }
                                                                    }
                                                                },
                                                                {name: "source_name", title: "측정방법", type: "text", align: "center"},
                                                                {name: "note", title: "메모", type: "text", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let bloodSugarChart;
                                                    function initBloodSugarChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const beforeMealDatas = [];
                                                        const afterMealDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            if(data.period === 1) {
                                                                beforeMealDatas.push({x: data.log_dttm, y: data.bs});
                                                            }
                                                            if(data.period === 2) {
                                                                afterMealDatas.push({x: data.log_dttm, y: data.bs});
                                                            }
                                                        })

                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());

                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: beforeMealDatas,
                                                                label: "식전",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            },  {
                                                                data: afterMealDatas,
                                                                label: "식후",
                                                                borderColor: "#3cba9f",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (bloodSugarChart !== undefined) {
                                                            bloodSugarChart.destroy();
                                                        }

                                                        bloodSugarChart = new Chart(
                                                            document.getElementById("bloodSugarLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="weightArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">체중</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#weightLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#weightTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="weightLine">
                                                                    <canvas id="weightLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="weightTable">
                                                                    <span>표준 골격근(%): 남성(32.9~35.7) 여성(25.9~27.9)</span>
                                                                    <br>
                                                                    <span>표준 체지방률(%): 남성(10~19.9) 여성(20~29.9)</span>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initWeightLogData(params){
                                                        $.ajax({
                                                            url: "/v1/weight-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initWeightTable(logDatas);
                                                                initWeightChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initWeightTable(logDatas) {
                                                        $("#weightTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "weight", title: "체중", type: "number", align: "center"},
                                                                {name: "bmi", title: "BMI", type: "text", align: "center"},
                                                                {name: "body_fat", title: "체지방률", type: "number", align: "center"},
                                                                {name: "waist", title: "허리둘레", type: "number", align: "center"},
                                                                {name: "sk_muscle_pct", title: "골격근율", type: "number", align: "center"},
                                                                {name: "source_name", title: "측정방법", type: "number", align: "center"},
                                                                {name: "note", title: "메모", type: "body", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let weightChart;
                                                    function initWeightChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const weightDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            weightDatas.push({x: data.log_dttm, y: data.weight});
                                                        })
                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());
                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: weightDatas,
                                                                label: "체중",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (weightChart !== undefined) {
                                                            weightChart.destroy();
                                                        }

                                                        weightChart = new Chart(
                                                            document.getElementById("weightLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="mealArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">식사</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#mealLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#mealTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="mealLine">
                                                                    <canvas id="mealLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="mealTable" style="height: 500px; overflow:scroll;">

                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initMealLogData(params){
                                                        $.ajax({
                                                            url: "/meal-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initMealChart(logDatas);
                                                            }
                                                        });

                                                        $.ajax({
                                                            url: "/meal-logs/group-by-date",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                $("#mealTable").replaceWith(logDatas);
                                                            }
                                                        });
                                                    }

                                                    let mealChart;
                                                    function initMealChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const mealDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            mealDatas.push({x: data.log_dttm, y: data.total_calories});
                                                        })
                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());

                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: mealDatas,
                                                                label: "총 칼로리",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (mealChart !== undefined) {
                                                            mealChart.destroy();
                                                        }

                                                        mealChart = new Chart(
                                                            document.getElementById("mealLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="stepArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">걸음</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#stepLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#stepTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="stepLine">
                                                                    <canvas id="stepLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="stepTable">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initStepLogData(params){
                                                        $.ajax({
                                                            url: "/step-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initStepTable(logDatas);
                                                                initStepChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initStepTable(logDatas) {
                                                        $("#stepTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        return value.replace("T", " ");
                                                                    }
                                                                },
                                                                {name: "cal_out", title: "소모 칼로리", type: "text", align: "center"},
                                                                {name: "source_name", title: "종류", type: "body", align: "center"},
                                                                {name: "step_count", title: "운동량", type: "text", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        return value + " 걸음";
                                                                    }
                                                                }
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let StepChart;
                                                    function initStepChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const stepDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            stepDatas.push({x: data.log_dttm, y: data.step_count});
                                                        })
                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());

                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: stepDatas,
                                                                label: "걸음",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            unit: 'week'
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (StepChart !== undefined) {
                                                            StepChart.destroy();
                                                        }

                                                        StepChart = new Chart(
                                                            document.getElementById("stepLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="exerciseArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">운동</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#exerciseLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#exerciseTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="exerciseLine">
                                                                    <canvas id="exerciseLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="exerciseTable">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initExerciseLogData(params) {
                                                        $.ajax({
                                                            url: "/exercise-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initExerciseTable(logDatas);
                                                                initExerciseChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initExerciseTable(logDatas) {
                                                        $("#exerciseTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "calories_out", title: "소모 칼로리", type: "number", align: "center"},
                                                                {name: "exercise_name", title: "종류", type: "text", align: "center"},
                                                                {name: "duration", title: "운동량", type: "text", align: "center"},
                                                                {name: "note", title: "메모", type: "text", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let exerciseChart;
                                                    function initExerciseChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const exerciseDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            exerciseDatas.push({x: data.log_dttm, y: data.duration});
                                                        })

                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());
                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: exerciseDatas,
                                                                label: "운동량",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (exerciseChart !== undefined) {
                                                            exerciseChart.destroy();
                                                        }

                                                        exerciseChart = new Chart(
                                                            document.getElementById("exerciseLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="medicationArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">복약</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#medicationBar" data-toggle="tab">
                                                                    <i class="far fa-chart-bar"></i>막대차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#medicationTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="medicationBar">
                                                                    <canvas id="medicationBarChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="medicationTable">
                                                                    <table class="table table-bordered">
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initMedicationLogData(params) {
                                                        $.ajax({
                                                            url: "/medication-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (medicationLogDatas) {
                                                                initMedacationTable(medicationLogDatas);
                                                                initMedicationChart(medicationLogDatas);
                                                            }
                                                        });
                                                    }


                                                    function initMedacationTable(logDatas) {
                                                        $("#medicationTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "복약일시", type: "number", align: "center"},
                                                                {name: "medication_type", title: "복약구분", type: "text", align: "center",
                                                                    itemTemplate: function(value, item) {
                                                                        return item.medication_type_name;
                                                                    }
                                                                },
                                                                {name: "medicines", title: "복약종류", type: "body", align: "center",
                                                                    itemTemplate: function(value, item) {
                                                                        return item.medicines_type_name;
                                                                    }
                                                                },
                                                                {name: "insulin_type", title: "인슐린 종류", type: "text", align: "center",
                                                                    itemTemplate: function(value, item) {
                                                                        return item.insulin_type_name;
                                                                    }
                                                                },
                                                                {name: "dose", title: "주사량", type: "text", align: "center"},
                                                                {name: "note", title: "메모", type: "text", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let medicationBarChart;
                                                    function goupingByLogDate(datas) {
                                                        const result = Object.values(datas.reduce((r, o) => (r[o.x]
                                                            ? (r[o.x].y += o.y)
                                                            : (r[o.x] = {...o}), r), {}));
                                                        return result;
                                                    }

                                                    function initMedicationChart(logDatas) {
                                                        logDatas.reverse();

                                                        let labels = [];
                                                        let beforeMealDatas = [];
                                                        let afterMealDatas = [];
                                                        let etcDatas = [];
                                                        let insulinDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(data.log_date);
                                                            // 0: 기본값 1: 식전  2: 식후 3: 기타  4: 인슐린
                                                            if (data.medication_type === 1) beforeMealDatas.push({x: data.log_date, y: data.dose});
                                                            if (data.medication_type === 2) afterMealDatas.push({x: data.log_date, y: data.dose});
                                                            if (data.medication_type === 3) etcDatas.push({x: data.log_date, y: data.dose});
                                                            if (data.medication_type === 4) insulinDatas.push({x: data.log_date, y: data.dose});
                                                        })

                                                        beforeMealDatas = goupingByLogDate(beforeMealDatas);
                                                        afterMealDatas = goupingByLogDate(afterMealDatas);
                                                        etcDatas = goupingByLogDate(etcDatas);
                                                        insulinDatas = goupingByLogDate(insulinDatas);

                                                        const minDate = labels[0];

                                                        var barChartData = {
                                                            datasets: [{
                                                                label: '식전',
                                                                backgroundColor: "#e5ae5c",
                                                                data: beforeMealDatas
                                                            }, {
                                                                label: '식후',
                                                                backgroundColor: "#66a75f",
                                                                data: afterMealDatas
                                                            }, {
                                                                label: '기타',
                                                                backgroundColor: "#6799FF",
                                                                data: etcDatas
                                                            },{
                                                                label: '인슐린',
                                                                backgroundColor: "#dc70a1",
                                                                data: insulinDatas
                                                            }]
                                                        };

                                                        const config = {
                                                            type: 'bar',
                                                            data: barChartData,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (medicationBarChart !== undefined) {
                                                            medicationBarChart.destroy();
                                                        }

                                                        medicationBarChart = new Chart(
                                                            document.getElementById("medicationBarChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="smokingArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">흡연</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#smokingLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#smokingTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="smokingLine">
                                                                    <canvas id="smokingLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="smokingTable">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initSmokingLogData(params){
                                                        $.ajax({
                                                            url: "/smoking-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initSmokingTable(logDatas);
                                                                initSmokingChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initSmokingTable(logDatas) {
                                                        $("#smokingTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "smoking_type", title: "담배종류", type: "text", align: "center" ,
                                                                    itemTemplate: function (value, item) {
                                                                        if(value === 1) return "일반담배"
                                                                        if(value === 2) return "궐련형 전자담배"
                                                                        if(value === 3) return "액상형 전자담배"
                                                                    }
                                                                },
                                                                {name: "smoking_count", title: "흡연량", type: "body", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let smokingChart;
                                                    function initSmokingChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const smokingType1Datas = [];
                                                        const smokingType2Datas = [];
                                                        const smokingType3Datas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            if(data.smoking_type === 1) smokingType1Datas.push({x: data.log_dttm, y: data.smoking_count});
                                                            if(data.smoking_type === 2) smokingType2Datas.push({x: data.log_dttm, y: data.smoking_count});  //"궐련형 전자담배"
                                                            if(data.smoking_type === 3) smokingType3Datas.push({x: data.log_dttm, y: data.smoking_count}); //"액상형 전자담배"
                                                        })
                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());

                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: smokingType1Datas,
                                                                label: "일반 담배",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }, {
                                                                data: smokingType2Datas,
                                                                label: "궐련형",
                                                                borderColor: "#3cba9f",
                                                                fill: false
                                                            }, {
                                                                data: smokingType3Datas,
                                                                label: "액상형",
                                                                borderColor: "#F361A6",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (smokingChart !== undefined) {
                                                            smokingChart.destroy();
                                                        }

                                                        smokingChart = new Chart(
                                                            document.getElementById("smokingLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="drinkingArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">음주</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#drinkingLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#drinkingTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="drinkingLine">
                                                                    <canvas id="drinkingLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="drinkingTable">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initDrinkingLogData(params){
                                                        $.ajax({
                                                            url: "/drinking-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initDrinkingTable(logDatas);
                                                                initDrinkingChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initDrinkingTable(logDatas) {
                                                        $("#drinkingTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "liquor_type", title: "술종류", type: "number", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        if(value === 1) return "소주";
                                                                        if(value === 2) return "맥주";
                                                                        if(value === 3) return "막걸리";
                                                                        if(value === 4) return "와인/샴페인";
                                                                        if(value === 5) return "위스키";
                                                                        if(value === 99) return "기타";
                                                                    }
                                                                },
                                                                {name: "drinking_amount", title: "음주량", type: "text", align: "center"},
                                                                {name: "note", title: "메모", type: "body", align: "center"},
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let drinkingChart;
                                                    function initDrinkingChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const drinkingDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            drinkingDatas.push({x: data.log_dttm, y: data.drinking_amount});
                                                        })

                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());
                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: drinkingDatas,
                                                                label: "음주량",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'week',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (drinkingChart !== undefined) {
                                                            drinkingChart.destroy();
                                                        }

                                                        drinkingChart = new Chart(
                                                            document.getElementById("drinkingLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id="sleepingArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">수면</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#sleepingLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#sleepingTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="sleepingLine">
                                                                    <canvas id="sleepingLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="sleepingTable">
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>

                                                </div>

                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initSleepingLogData(params) {
                                                        $.ajax({
                                                            url: "/sleeping-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initSleepingTable(logDatas);
                                                                initSleepingChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initSleepingTable(logDatas) {
                                                        $("#sleepingTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "text", align: "center"},
                                                                {name: "bedtime_dttm", title: "취침시각", type: "text", align: "center"},
                                                                {name: "duration", title: "수면시간", type: "number", align: "center"},
                                                                {name: "source_name", title: "측정방법", type: "text", align: "center"},
                                                                {name: "note", title: "메모", type: "text", align: "center"}
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let sleepingChart;
                                                    function initSleepingChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const sleepingDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            sleepingDatas.push({x: data.log_dttm, y: data.duration});
                                                        })

                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());

                                                        const data = {
                                                            datasets: [{
                                                                data: sleepingDatas,
                                                                label: "수면시간",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'month',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (sleepingChart !== undefined) {
                                                            sleepingChart.destroy();
                                                        }

                                                        sleepingChart = new Chart(
                                                            document.getElementById("sleepingLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>



                                                <div id ="depressionArea">
                                                    <div class="card card-outline">
                                                        <div class="card-header">
                                                            <h3 class="card-title">우울증</h3>
                                                            <div class="card-tools">
                                                                <button type="button" class="btn btn-tool" data-card-widget="collapse">
                                                                    <i class="fas fa-minus"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                        <div class="card-body carousel-item-right">
                                                            <ul class="nav nav-pills float-md-right">
                                                                <li class="nav-item"><a class="nav-link nav-link-default" href="#depressionLine" data-toggle="tab">
                                                                    <i class="fa fa-chart-line"></i>라인차트</a>
                                                                </li>
                                                                <li class="nav-item"><a class="nav-link active" href="#depressionTable" data-toggle="tab">
                                                                    <i class="fa fa-table"></i>목록형</a>
                                                                </li>
                                                            </ul>
                                                        </div>
                                                        <div class="card-body">
                                                            <div class="tab-content">
                                                                <div class="tab-pane active" id="depressionLine">
                                                                    <canvas id="depressionLineChart"></canvas>
                                                                </div>
                                                                <div class="tab-pane" id="depressionTable">
                                                                    <table class="table table-bordered">
                                                                    </table>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <!-- 스크립트 작성영역 -->
                                                <script>
                                                    function initDepressionLogData(params) {
                                                        $.ajax({
                                                            url: "/depresion-logs",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (logDatas) {
                                                                initDepressionTable(logDatas);
                                                                initDepressionChart(logDatas);
                                                            }
                                                        });
                                                    }

                                                    function initDepressionTable(logDatas) {
                                                        $("#depressionTable").jsGrid({
                                                            fields: [
                                                                {name: "log_dttm", title: "기록일시", type: "number", align: "center"},
                                                                {name: "depression_index", title: "우울증지수", type: "number", align: "center",
                                                                    itemTemplate: function (value, item) {
                                                                        // 정상 0~8점 : 검정색 / 경증 9점~12점 : 주황색 / 우울증 13점 이상 : 빨간색
                                                                        if(value >= 13) {
                                                                            return $("<div>").css("color", "red").html(value);
                                                                        } else if(value >= 9 && value <= 12) {
                                                                            return $("<div>").css("color", "orange").html(value);
                                                                        } else {
                                                                            return value;
                                                                        }
                                                                    }
                                                                }
                                                            ],
                                                            data: logDatas,
                                                            noDataContent: "조회된 결과가 없습니다.",

                                                            fixedHeader: true,
                                                            height: "300px",
                                                            width: "100%"
                                                        });
                                                    }

                                                    let depressionChart;
                                                    function initDepressionChart(logDatas) {
                                                        logDatas.reverse();

                                                        /* Line chart*/
                                                        let labels = [];
                                                        const depressionDatas = [];

                                                        logDatas.forEach(function(data) {
                                                            labels.push(new Date(data.log_dttm));
                                                            depressionDatas.push({x: data.log_dttm, y: data.depression_index});
                                                        })

                                                        const minDate = labels.length === 0? new Date() : new Date(labels[0].getFullYear(), labels[0].getMonth(), labels[0].getDate());

                                                        const data = {
                                                            labels: labels,
                                                            datasets: [{
                                                                data: depressionDatas,
                                                                label: "우울증 점수",
                                                                borderColor: "#3e95cd",
                                                                fill: false
                                                            }]
                                                        };
                                                        const config = {
                                                            type: 'line',
                                                            data: data,
                                                            options: {
                                                                scales: {
                                                                    x: {
                                                                        type: 'time',
                                                                        time: {
                                                                            displayFormats: {
                                                                                month: 'MMM dd'
                                                                            },
                                                                            unit: 'month',
                                                                        },
                                                                        min: minDate
                                                                    }
                                                                }
                                                            },
                                                        };

                                                        if (depressionChart !== undefined) {
                                                            depressionChart.destroy();
                                                        }

                                                        depressionChart = new Chart(
                                                            document.getElementById("depressionLineChart"),
                                                            config
                                                        );
                                                    }
                                                </script>


                                            </div>
                                            <!-- 혈당환자  -->

                                            <!-- 우울증환자  -->


                                            <!-- 스크립트 작성영역 -->
                                            <script>
                                                function searchLogs() {
                                                    $(".nav-link-default").addClass("active");

                                                    let userId = $("#userId").val();
                                                    let startDate = $("#searchStartDate").val()
                                                    let endDate = $("#searchEndDate").val()
                                                    let params ={userId: userId, startDate: startDate, endDate: endDate}


                                                    initBloodPressureLogData(params);
                                                    initMedicationLogData(params);
                                                    initBloodSugarLogData(params);
                                                    initStepLogData(params);
                                                    initExerciseLogData(params);
                                                    initMealLogData(params);
                                                    initWeightLogData(params);
                                                    initSmokingLogData(params);
                                                    initDrinkingLogData(params);
                                                    initSleepingLogData(params);
                                                    initDepressionLogData(params);
                                                }

                                                function changeSearchOption(selectedValue) {
                                                    let today = new Date();
                                                    $("#searchEndDate").datepicker("setDate", today);
                                                    if(selectedValue === '7DAYS') {
                                                        today.setDate(today.getDate() - 7);
                                                        $("#searchStartDate").datepicker("setDate", today);
                                                    };
                                                    if(selectedValue === '14DAYS') {
                                                        today.setDate(today.getDate() - 14);
                                                        $("#searchStartDate").datepicker("setDate", today);
                                                    }
                                                    if(selectedValue === '1MONTH') {
                                                        today.setMonth(today.getMonth() - 1);
                                                        $("#searchStartDate").datepicker("setDate", today);
                                                    }
                                                    if(selectedValue === '2MONTHS') {
                                                        today.setMonth(today.getMonth() - 2);
                                                        $("#searchStartDate").datepicker("setDate", today);
                                                    }
                                                    if(selectedValue === '3MONTHS') {
                                                        today.setMonth(today.getMonth() - 3);
                                                        $("#searchStartDate").datepicker("setDate", today);
                                                    }
                                                    if(selectedValue === '6MONTHS') {
                                                        today.setMonth(today.getMonth() - 6);
                                                        $("#searchStartDate").datepicker("setDate", today);
                                                    }
                                                    if(selectedValue === 'ALL') {
                                                        $("#searchStartDate").datepicker("setDate", null);
                                                        $("#searchEndDate").datepicker("setDate", null);
                                                    }

                                                }

                                                $('.area-toggle').change(function() {
                                                    const areaId = $(this).data('target-area');
                                                    $("#"+areaId).collapse('toggle');
                                                });


                                                $(function () {
                                                    searchLogs();

                                                    //Date picker
                                                    $('.datetimepicker-input').datepicker();

                                                    $("#bloodPressureArea").collapse($('[id^=bloodPressureChk]').prop('checked') ? "show" : "hide");
                                                    $("#bloodSugarArea").collapse($('[id^=bloodSugarChk]').prop('checked') ? "show" : "hide");
                                                    $("#weightArea").collapse($('[id^=weightChk]').prop('checked') ? "show" : "hide");
                                                    $("#mealArea").collapse($('[id^=mealChk]').prop('checked') ? "show" : "hide");
                                                    $("#stepArea").collapse($('[id^=stepChk]').prop('checked') ? "show" : "hide");
                                                    $("#exerciseArea").collapse($('[id^=exerciseChk]').prop('checked') ? "show" : "hide");
                                                    $("#medicationArea").collapse($('[id^=medicationChk]').prop('checked') ? "show" : "hide");
                                                    $("#drinkingArea").collapse($('[id^=drinkingChk]').prop('checked') ? "show" : "hide");
                                                    $("#sleepingArea").collapse($('[id^=sleepingChk]').prop('checked') ? "show" : "hide");
                                                    $("#smokingArea").collapse($('[id^=smokingChk]').prop('checked') ? "show" : "hide");
                                                    $("#depressionArea").collapse($('[id^=depressionChk]').prop('checked') ? "show" : "hide");

                                                });
                                            </script>

                                        </div></div>
                                        <div class="tab-pane" id="surveyRecords"><div>

                                            <div class="text-black">설문 수행 현황</div>
                                            <div class="card-body">
                                                <div class="float-md-right">
                                                    <button class="btn btn-default float-md-right" data-toggle="modal"
                                                            data-target="#modal-add-survey-form"
                                                            onclick="openAdminSurveyForm()">
                                                        의료연구진 설문 등록
                                                    </button>
                                                </div>
                                            </div>
                                            <div id="userSurveyRecordsDiv">
                                                <div class="card card-outline">
                                                    <div class="card-body">
                                                        <div class="form-group row">
                                                            <label class="col-sm-1 col-form-label">대분류</label>
                                                            <div class="col-sm-5 input-group">
                                                                <select class="select2 form-control"
                                                                        data-select2-id="1" tabindex="-1" aria-hidden="true"
                                                                        id="searchSurveyId">

                                                                </select>
                                                            </div>
                                                            <div class="input-group-append">
                                                                <button type="submit" class="btn btn-success float-right" onclick="getQuestionAnswers()">검색</button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="card card-outline">
                                                    <div class="card-body">
                                                        <div class="form-group row">
                                                            <div class="col-sm-10 text-black">응답결과</div>
                                                            <div class="col-sm-2 text-black float-md-right text-right">
                                                                <input type="hidden" id="expandedAll" value="true">
                                                                <a href="javascript:detailAreaToggle()">
                                                                    <i class="fa fa-minus" id="expandIcon">모두 접기</i>
                                                                </a>
                                                            </div>
                                                        </div>
                                                        <table class="table table-hover">
                                                            <thead>
                                                            <tr>
                                                                <th></th>
                                                                <th>번호</th>
                                                                <th>항목</th>
                                                                <th>응답횟수</th>
                                                            </tr>
                                                            </thead>
                                                            <tbody>

                                                            <tr><td colspan="4" align="center">조회된 결과가 없습니다.</td></tr>


                                                            </tbody>
                                                        </table>
                                                    </div>
                                                </div>
                                            </div>


                                            <!--설문 등록 모달-->
                                            <div class="modal fade" id="modal-add-survey-form">
                                                <div class="modal-dialog modal-lg">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title" >의료 연구진 설문 등록</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body" id="adminSurveyFilter">
                                                            <form id="admin-survey-form" onsubmit="saveAdminSurveyAnswer(); return false;">
                                                                <div class="form-group row">
                                                                    <label class="col-form-label col-sm-1" for="serviceGroupResourceId">주차</label>
                                                                    <select class="form-control col-md-3" name="serviceGroupResourceId" id="serviceGroupResourceId" required>
                                                                        <option value="">선택</option>

                                                                    </select>
                                                                </div>
                                                                <div class="table-responsive" style="height:700px; width:100%;" >
                                                                    <table class="table table-bordered table-head-fixed text-nowrap" style="width:100%;">
                                                                        <thead align="center">
                                                                        <tr>
                                                                            <th>번호</th>
                                                                            <th>설문내용</th>
                                                                            <th>응답</th>
                                                                        </tr>
                                                                        </thead>
                                                                        <tbody>

                                                                        </tbody>
                                                                    </table>
                                                                </div>
                                                                <div class="modal-footer justify-content-center">
                                                                    <button type="submit" class="btn btn-success">저장</button>
                                                                    <button type="button" class="btn btn-default" data-dismiss="modal">취소</button>
                                                                </div>
                                                            </form>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <!--// 설문 등록 모달-->
                                            <!-- 스크립트 작성영역 -->
                                            <script>
                                                function detailAreaToggle(){
                                                    const expandedAll = $("#expandedAll").val();
                                                    if(expandedAll === 'true') {
                                                        closeAllDetail();
                                                    } else {
                                                        expandAllDetail();
                                                    }
                                                }

                                                function expandAllDetail() {
                                                    $('tr[data-widget="expandable-table"]').each(function(){
                                                        $(this).attr("aria-expanded", false);
                                                        $(this).ExpandableTable('toggleRow');
                                                    });
                                                    $("#expandedAll").val('true');
                                                    $("#expandIcon").removeClass().addClass("fa fa-minus").text("모두 접기");
                                                }

                                                function closeAllDetail() {
                                                    $('tr[data-widget="expandable-table"]').each(function(){
                                                        $(this).attr("aria-expanded", true);
                                                        $(this).ExpandableTable('toggleRow');
                                                    });
                                                    $("#expandedAll").val('false');
                                                    $("#expandIcon").removeClass().addClass("fa fa-plus").text("모두 펼치기");
                                                }

                                                function getQuestionAnswers() {
                                                    let userId = $("#userId").val();
                                                    let surveyId = $("#searchSurveyId").val();

                                                    $.ajax({
                                                        url: "/users/" + userId + "/surveys/",
                                                        type: "GET",
                                                        data: {surveyId: surveyId},
                                                        success: function (fragment) {
                                                            $("#userSurveyRecordsDiv").replaceWith(fragment);
                                                        }
                                                    });
                                                }

                                                function openAdminSurveyForm() {
                                                    $.ajax({
                                                        url: "/admin-surveys",
                                                        type: "GET",
                                                        success: function (fragment) {
                                                            adminSurvey = null;
                                                            $("#adminSurveyFilter").replaceWith(fragment);
                                                        }
                                                    });
                                                }

                                                /** 의료 연구진 설문 등록 */
                                                function saveAdminSurveyAnswer() {
                                                    // 파라미터 세팅
                                                    let params = [];
                                                    $(".admin-survey-answers").each(function() {
                                                        let userAnswers = [];
                                                        let choiceIds = [];
                                                        $(this).children('td').children('div').children('input.userAnswer').each(function() {
                                                            userAnswers.push($(this).val());
                                                        })

                                                        $(this).children('td').children('div').children('input.choicedId:checked').each(function() {
                                                            choiceIds.push($(this).val());
                                                        })

                                                        var param = {
                                                            "userId": $("#userId").val(),
                                                            "serviceGroupResourceId": $("#serviceGroupResourceId").val(),
                                                            "questionId": $(this).children('input').attr('questionId'),
                                                            "choiceIds": choiceIds,
                                                            "choiceUserAnswer": $(this).children('td').children('div').children('input.choicedUserAnswer').val(),
                                                            "userAnswers": userAnswers
                                                        }
                                                        params.push(param);
                                                    });

                                                    $.ajax({
                                                        url: "/admin-surveys",
                                                        type: "POST",
                                                        data: JSON.stringify(params),
                                                        contentType: "application/json",
                                                        success: function() {
                                                            alert("응답이 저장되었습니다.");
                                                            $("#modal-add-survey-form").modal('hide');

                                                        }
                                                    });
                                                }

                                                function maxLengthCheck(object){
                                                    if (object.value.length > object.maxLength){
                                                        object.value = object.value.slice(0, object.maxLength);
                                                    }
                                                }

                                                $(function (){
                                                    getQuestionAnswers();
                                                })
                                            </script>
                                        </div></div>
                                        <div class="tab-pane" id="diary"><div>
                                            <style>
                                                .table td {
                                                    text-align: center;
                                                }
                                            </style>
                                            <div class="form-group row col-md-12">
                                                <div class="text-black col-md-10">기록 결과</div>
                                                <div class="text-black float-md-right col-md-1 text-right">주차</div>
                                                <select class="select2 diary-week-select"
                                                        tabindex="-1" aria-hidden="true"
                                                        onchange="getMemoDatas(this.value)">
                                                    <option selected="selected" value="all">전체</option>
                                                    <option value="1">1</option>
                                                    <option value="2">2</option>
                                                    <option value="3">3</option>
                                                    <option value="4">4</option>
                                                    <option value="5">5</option>
                                                    <option value="6">6</option>
                                                    <option value="7">7</option>
                                                    <option value="8">8</option>
                                                    <option value="9">9</option>
                                                    <option value="10">10</option>
                                                    <option value="11">11</option>
                                                    <option value="12">12</option>
                                                    <option value="13">13</option>
                                                    <option value="14">14</option>
                                                    <option value="15">15</option>
                                                    <option value="16">16</option>
                                                    <option value="17">17</option>
                                                    <option value="18">18</option>
                                                    <option value="19">19</option>
                                                    <option value="20">20</option>
                                                    <option value="21">21</option>
                                                    <option value="22">22</option>
                                                    <option value="23">23</option>
                                                    <option value="24">24</option>
                                                    <option value="25">25</option>
                                                    <option value="26">26</option>
                                                    <option value="27">27</option>
                                                    <option value="28">28</option>
                                                    <option value="29">29</option>
                                                    <option value="30">30</option>
                                                    <option value="31">31</option>
                                                    <option value="32">32</option>
                                                    <option value="33">33</option>
                                                    <option value="34">34</option>
                                                    <option value="35">35</option>
                                                    <option value="36">36</option>
                                                    <option value="37">37</option>
                                                    <option value="38">38</option>
                                                    <option value="39">39</option>
                                                    <option value="40">40</option>
                                                    <option value="41">41</option>
                                                    <option value="42">42</option>
                                                    <option value="43">43</option>
                                                    <option value="44">44</option>
                                                    <option value="45">45</option>
                                                    <option value="46">46</option>
                                                    <option value="47">47</option>
                                                    <option value="48">48</option>
                                                    <option value="49">49</option>
                                                    <option value="50">50</option>
                                                    <option value="51">51</option>
                                                    <option value="52">52</option>
                                                </select>
                                            </div>
                                            <div class="card-body" >
                                                <table class="table table-bordered" id="diaryDataTable">
                                                    <thead>
                                                    <tr>
                                                        <th>번호</th>
                                                        <th>작성일자</th>
                                                        <th class="sorting" tabindex="0" aria-controls="diaryTable" rowspan="1" colspan="1" aria-label="Rendering engine: activate to sort column ascending">주차</th>
                                                        <th>제목</th>
                                                        <th>감정상태</th>
                                                        <th>열람</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                            </div>
                                            <div class="modal fade" id="modal-diary-detail-view">
                                                <div class="modal-dialog modal-mg">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h4 class="modal-title">기록 상세</h4>
                                                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                        </div>
                                                        <div class="modal-body" id="modal-diary-detail">

                                                        </div>
                                                    </div>
                                                    <!-- /.modal-content -->
                                                </div>
                                                <!-- /.modal-dialog -->

                                            </div>
                                            <script>
                                                $(function () {
                                                    $('.diary-week-select').select2();
                                                    getMemoDatas();
                                                });

                                                function showMemoDetail(memoId, gestationalWeeks) {
                                                    $.ajax({
                                                        url: '/diaries/memos/' + memoId,
                                                        type: "GET",
                                                        success: function (data){
                                                            $("#modal-diary-detail").replaceWith(data);
                                                        },
                                                        complete: function (){
                                                            $("#detailData-gestationalWeeks").html(gestationalWeeks + "주차");
                                                        }
                                                    });
                                                }

                                                function getMemoDatas(gestationalWeeks) {
                                                    var userId = $("#userId").val();

                                                    $.ajax({
                                                        url: '/diaries/memos/by/' + userId,
                                                        type: "GET",
                                                        data: {gestationalWeeks: gestationalWeeks === 'all' ? null : gestationalWeeks},
                                                        success: function (fragment){
                                                            $("#diaryDataTable").replaceWith(fragment);
                                                            $("#diaryDataTable").DataTable({
                                                                paging: false,
                                                                searching: false,
                                                                info: false,
                                                                columnDefs: [
                                                                    { className: 'text-center align-middle', targets: [0, 1, 2, 3, 4, 5] }
                                                                ],
                                                                autoWidth: false,
                                                                order: [ [2, 'desc'] ],
                                                                language: {
                                                                    "emptyTable": "조회된 결과가 없습니다."
                                                                },
                                                                columns: [
                                                                    { orderable: false, "width": "10%" },
                                                                    { orderable: false, "width": "13%" },
                                                                    { orderable: true, "width": "10%" },
                                                                    { orderable: false, "width": "40%" },
                                                                    { orderable: false, "width": "15%" },
                                                                    { orderable: false, "width": "13%" }
                                                                ]
                                                            });
                                                        }
                                                    })
                                                }
                                            </script>
                                        </div></div>
                                        <div class="tab-pane" id="hospitalVisitRecords"><div>
                                            <div class="text-black">기록 결과</div>
                                            <div class="card-body table-responsive p-0" id="hospitalVisitDatas" style="height:1000px;">
                                                <table class="table table-bordered table-head-fixed text-nowrap">
                                                    <thead align="center">
                                                    <tr>
                                                        <th>번호</th>
                                                        <th>병원</th>
                                                        <th>일자</th>
                                                        <th>메모</th>
                                                        <th>작성일자</th>
                                                    </tr>
                                                    </thead>
                                                    <tbody>

                                                    </tbody>
                                                </table>
                                                <div align="center" class="text-center">조회된 결과가 없습니다.</div>
                                            </div>
                                            <script>
                                                $(function () {
                                                    var visitorId = $("#userId").val();
                                                    $.ajax({
                                                        url: "/hospital-visits/visitors/" + visitorId,
                                                        type: "GET",
                                                        success: function (fragment) {
                                                            $("#hospitalVisitDatas").replaceWith(fragment);
                                                        }
                                                    })
                                                })
                                            </script>
                                        </div></div>
                                        <div class="tab-pane" id="babyRecords">

                                            <div>

                                                <div class="text-black">기록 결과</div>

                                                <div>
                                                    <form>
                                                        <div class="form-group row">
                                                            <select class="form-control col-sm-2" onchange="changeBabyRecordSearchOption(this.value)">
                                                                <option value="ALL">전체</option>
                                                                <option value="7DAYS">7일</option>
                                                                <option value="14DAYS">14일</option>
                                                                <option value="1MONTH">1개월</option>
                                                                <option value="2MONTHS">2개월</option>
                                                                <option value="3MONTHS">3개월</option>
                                                                <option value="6MONTHS">6개월</option>
                                                            </select>
                                                            <div class="input-group date col-sm-4"  data-target-input="nearest">
                                                                <input type="text" class="form-control datetimepicker-input" id="baby-record-search-start-date">
                                                                <div class="input-group-append" data-toggle="datetimepicker">
                                                                    <div class="input-group-text "><i class="fa fa-calendar "></i></div>
                                                                </div>
                                                            </div>
                                                            ~
                                                            <div class="input-group date col-sm-4" data-target-input="nearest" >
                                                                <input type="text" class="form-control datetimepicker-input" id="baby-record-search-end-date">
                                                                <div class="input-group-append" data-toggle="datetimepicker">
                                                                    <div class="input-group-text "><i class="fa fa-calendar"></i></div>
                                                                </div>
                                                            </div>
                                                            <div class="input-group-append">
                                                                <button type="button" class="btn btn-md btn-success" onclick="searchBabyRecords()">
                                                                    <i class="fa fa-search"></i>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </form>
                                                </div>

                                                <div id="babyRecordDatas">
                                                    <input type="hidden" id="babyId" value="">

                                                    <div>
                                                        <div id="grid-baby-records"></div>
                                                        <div align="center" class="text-center">산모의 신생아 기본정보 입력 대기중입니다.</div>
                                                    </div>

                                                    <script>
                                                        $(function () {
                                                            loadBabyRecordTable(null);
                                                        })

                                                        function loadBabyRecordTable(babyRecords) {
                                                            $("#grid-baby-records").jsGrid({
                                                                fields: [
                                                                    {name: "id", title: "번호", type: "number", align: "center"},
                                                                    {name: "recordDttm", title: "기록일시", type: "text", align: "center",
                                                                        itemTemplate: function (value, item) {
                                                                            return value.replace('T', " ");
                                                                        }
                                                                    },
                                                                    {name: "height", title: "신장(cm)", type: "body", align: "center"},
                                                                    {name: "weight", title: "체중(kg)", type: "text", align: "center"},
                                                                    {name: "headCircumference", title: "머리둘레(cm)", type: "text", align: "center"},
                                                                    {name: "memo", title: "메모", type: "text", align: "center",
                                                                        itemTemplate: function (value, item) {
                                                                            return $('<button class="btn btn-success float-md" data-toggle="modal" data-target="#baby-record-memo-modal" onclick="setMemo(this.value)">보기</button>')
                                                                                .attr("value", value);
                                                                        }
                                                                    }
                                                                ],
                                                                data: babyRecords,
                                                                noDataContent: "조회된 결과가 없습니다.",

                                                                fixedHeader: true,
                                                                height: "auto",
                                                                width: "100%",

                                                                // filtering: true,
                                                                inserting: false,
                                                                // editing: true,
                                                                sorting: true,
                                                                paging: true,
                                                                autoload: true,
                                                                selecting: true,

                                                                pageIndex: 1,
                                                                pageSize: 50,
                                                                pageButtonCount: 5
                                                            });
                                                        }

                                                    </script>
                                                </div>

                                                <div class="modal fade" id="baby-record-memo-modal">
                                                    <div class="modal-dialog">
                                                        <div class="modal-content">
                                                            <div class="modal-header justify-content-center">
                                                                <h5 class="modal-title">메모</h5>
                                                            </div>
                                                            <div class="modal-body">
                                                                <p></p>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                <script>
                                                    $(function () {
                                                        getBabyInfoAndRecords();
                                                    })

                                                    function getBabyInfoAndRecords() {
                                                        const momId = $("#userId").val();
                                                        $.ajax({
                                                            url: "/baby-records/" + momId,
                                                            type: "GET",
                                                            success: function (fragment) {
                                                                $("#babyRecordDatas").replaceWith(fragment);
                                                            }
                                                        })
                                                    }

                                                    function controlHospitalInfo() {
                                                        if ($("#isHospitalized").val() === 'true') {
                                                            $("#hospitalizedDttm").attr("disabled", false);
                                                            $("#hospitalizedPeriod").attr("disabled", false);
                                                        } else {
                                                            $("#hospitalizedDttm").attr("disabled", true);
                                                            $("#hospitalizedPeriod").attr("disabled", true);
                                                        }
                                                    }

                                                    function controlUpdateBtn() {
                                                        if ($('#orginalBirthType').val() !== $('#birthType').val()
                                                            || $('#orginalApgarScore').val() !== $('#apgarScore').val()
                                                            || IsHospitalizedHasChanged()
                                                            || isValidHospitalizedInfo()
                                                        ) {
                                                            $("#baby-info-update-btn").attr("disabled", false);
                                                        } else {
                                                            $("#baby-info-update-btn").attr("disabled", true);
                                                        }
                                                    }

                                                    function IsHospitalizedHasChanged() {
                                                        if ($('#orginalIsHospitalized').val() !== $('#isHospitalized').val())
                                                            return $('#isHospitalized').val() === 'false';
                                                    }

                                                    function isValidHospitalizedInfo() {
                                                        if ($('#isHospitalized').val() === 'true') {
                                                            if (($('#hospitalizedDttm').val() !== null && $('#hospitalizedDttm').val() !== "") && $('#hospitalizedPeriod').val() !== null)
                                                                return $('#orginalHospitalizedDttm').val() !== $('#hospitalizedDttm').val() || $('#orginalHospitalizedPeriod').val() !== $('#hospitalizedPeriod').val();
                                                            return false;
                                                        }
                                                    }

                                                    function updateBabyInfo() {
                                                        const babyId = $('#babyId').val();
                                                        const hospitalizedDttm = $('#hospitalizedDttm').val();
                                                        const year = hospitalizedDttm.substring(0, 4);
                                                        const month = hospitalizedDttm.substring(4, 6);
                                                        const day = hospitalizedDttm.substring(6, 8);
                                                        const isHospitalized = $('#isHospitalized').val();
                                                        $.ajax({
                                                            url: "/babies/" + babyId,
                                                            type: "POST",
                                                            data: {
                                                                birthType: $('#birthType').val(),
                                                                isHospitalized: isHospitalized,
                                                                hospitalizedDttm: (isHospitalized === 'true' && hospitalizedDttm !== "")
                                                                    ? new Date(year, month - 1, day, 9).toISOString()
                                                                    : null, // ISOTime은 미국 기준이기 때문에 9시간을 더 해줘야 한다.
                                                                hospitalizedPeriod: isHospitalized === 'true' ? $('#hospitalizedPeriod').val() : null,
                                                                apgarScore: $('#apgarScore').val()
                                                            },
                                                            success: function (fragment) {
                                                                alert("저장되었습니다.")
                                                                $('#baby-info').replaceWith(fragment);
                                                                $('body').removeClass("modal-open");
                                                                $('.modal-backdrop').remove();
                                                            }
                                                        })
                                                    }

                                                    function searchBabyRecords() {
                                                        const babyId = $('#babyId').val();
                                                        let startDate = $("#baby-record-search-start-date").val()
                                                        let endDate = $("#baby-record-search-end-date").val()
                                                        let params = {babyId: babyId, startDate: startDate, endDate: endDate}

                                                        $.ajax({
                                                            url: "/baby-records",
                                                            type: "GET",
                                                            data: params,
                                                            success: function (babyRecords) {
                                                                loadBabyRecordTable(babyRecords)
                                                            }
                                                        });
                                                    }

                                                    function changeBabyRecordSearchOption(selectedValue) {
                                                        let today = new Date();
                                                        $("#baby-record-search-end-date").datepicker("setDate", today);
                                                        if(selectedValue === '7DAYS') {
                                                            today.setDate(today.getDate() - 7);
                                                            $("#baby-record-search-start-date").datepicker("setDate", today);
                                                        };
                                                        if(selectedValue === '14DAYS') {
                                                            today.setDate(today.getDate() - 14);
                                                            $("#baby-record-search-start-date").datepicker("setDate", today);
                                                        }
                                                        if(selectedValue === '1MONTH') {
                                                            today.setMonth(today.getMonth() - 1);
                                                            $("#baby-record-search-start-date").datepicker("setDate", today);
                                                        }
                                                        if(selectedValue === '2MONTHS') {
                                                            today.setMonth(today.getMonth() - 2);
                                                            $("#baby-record-search-start-date").datepicker("setDate", today);
                                                        }
                                                        if(selectedValue === '3MONTHS') {
                                                            today.setMonth(today.getMonth() - 3);
                                                            $("#baby-record-search-start-date").datepicker("setDate", today);
                                                        }
                                                        if(selectedValue === '6MONTHS') {
                                                            today.setMonth(today.getMonth() - 6);
                                                            $("#baby-record-search-start-date").datepicker("setDate", today);
                                                        }
                                                        if(selectedValue === 'ALL') {
                                                            $("#baby-record-search-start-date").datepicker("setDate", null);
                                                            $("#baby-record-search-end-date").datepicker("setDate", null);
                                                        }
                                                    }

                                                    function setMemo(memo) {
                                                        $('#baby-record-memo-modal .modal-body p').text(memo);
                                                    }

                                                </script>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </div>

    <footer class="main-footer">
        <strong>Copyright &copy; 2022 <a href="https://www.huray.net/">Huraypositive</a>.</strong> All rights reserved.
        <div class="float-right d-none d-sm-inline-block">
            <b>Version</b> 0.0.1
        </div>
    </footer>

    <aside class="control-sidebar control-sidebar-dark">
        <!-- Control sidebar content goes here -->
    </aside>
</div>
<!-- ./wrapper -->


<script>
    $.widget.bridge('uibutton', $.ui.button)
    $('.nav-pills').find('a').each(function () {
        let $this = $(this);
        let next = $this.next();

        $this.toggleClass('active', $this.attr('href') === window.location.pathname);
    });

    function getAdminId() {
        let adminName = "huray.himom"

        $.ajax({
            url: "/users/get-user-id",
            type: "GET",
            data: {
                id: adminName
            },
            success: function (data) {
                location.href = "/password/" + data
            }
        });
    }

    function healthCheck() {
        let flag = true;

        $.ajax({
            url: "/users/check-session",
            method: "GET",
            contentType: 'application/json; charset=utf-8',
            success: function (data) {
                if (data && data.length > 0) {
                    console.log("session-ended")
                    alert("세션이 종료되었습니다")
                    window.location.replace("/login");
                    flag = false;
                }
            },
            error: function (data) {
                console.log("error");
                console.log(data);
            }
        });

        return flag;
    }

    /*
    setInterval(healthCheck, 60000);
     */

    function checkResponseURL(xhr) {
        if (xhr.includes('login')) {
            console.log("++replace")
            window.location.replace("/login");
            return false;
        } else {
            console.log("NON")
        }
    }

    $(function () {
        $.ajax({
            url: "/users/admininfo",
            type: "GET",
            success: function (data) {
                let fullText = data.name + "( " + data.loginId + " )";
                if (fullText.length >= 15) fullText = fullText.substring(0, 15) + "...";
                $('#nav-site-name').text(data.siteName)
                $('#nav-admin-full').text(fullText)
                // $('#nav-admin-name').text(data.name)
                // $('#nav-admin-loginid').text(data.loginId)
                $('#nav-admin-authentication').text(data.roleDetail)
            }
        });


    });
</script>
<script src="/js/overlayScrollbars/jquery.overlayScrollbars.min.js"></script>

<!-- jsGrid -->
<script src="/js/jsgrid/jsgrid.min.js"></script>

<!-- demo -->
<!-- TODO: 모든 리스트뷰 구현 후 삭제 -->
<script src="/js/jsgrid/demos/db.js"></script>

</body>
</html>

<script>
    $(function (){
        $(".sidebar-mini").addClass("sidebar-collapse");
        $(".nav-link-default").addClass("active");
    })
</script>
